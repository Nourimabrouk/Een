<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unity Mathematics Synthesis | Een</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/unified-styles.css" />
    
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --bg: #0a0a0a;
            --surface: #151515;
            --text: #ffffff;
            --muted: #9aa0a6;
            --phi: 1.618033988749895;
            --gold: #FFD700;
            --cyan: #00D4FF;
            --violet: #9d4edd;
            --radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: Inter, system-ui, sans-serif;
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 120px 24px 48px;
        }

        .hero {
            text-align: center;
            margin-bottom: 32px;
        }

        .hero h1 {
            font-weight: 800;
            letter-spacing: -0.02em;
            font-size: clamp(2rem, 5vw, 3rem);
            color: var(--gold);
        }

        .tagline {
            color: var(--muted);
            margin-top: 8px;
            font-size: 1.05rem;
        }

        .grid {
            display: grid;
            gap: 24px;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }

        .card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .card h3 {
            margin: 0 0 8px 0;
            color: var(--cyan);
        }

        .pill {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--cyan);
            font-size: 12px;
            margin-right: 6px;
        }

        .metric {
            font-family: "JetBrains Mono", monospace;
            color: var(--gold);
            font-size: 14px;
        }

        .viz {
            height: 420px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .controls input,
        .controls button {
            background: var(--surface);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            padding: 10px 12px;
            font-family: Inter;
        }

        .controls button {
            cursor: pointer;
            background: linear-gradient(135deg, var(--cyan), var(--violet));
            border: none;
            font-weight: 600;
        }

        .list {
            margin: 0;
            padding-left: 18px;
            color: var(--muted);
        }

        .eq {
            font-family: "JetBrains Mono", monospace;
            color: var(--gold);
        }
    </style>
    <!-- Unified Navigation System - Meta-Optimal One-Line Solution -->
    <script src="js/nav-template-applier.js" defer></script>
</head>

<body>
    <div class="container">
        <div class="hero">
            <h1>Unity Mathematics Synthesis</h1>
            <div class="tagline">Rigorous, cross-domain demonstration that <span class="eq">1 + 1 = 1</span> in
                idempotent and emergent frameworks</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Metagamer Energy</h3>
                <div class="pill">E = φ² × ρ × U</div>
                <div class="controls">
                    <input id="rho" type="number" step="0.01" placeholder="ρ (density)" value="0.77" />
                    <input id="unityRate" type="number" step="0.01" placeholder="U (unity rate)" value="0.88" />
                    <button id="computeEnergy">Compute</button>
                </div>
                <p class="metric" id="energyOut">energy: —</p>
            </div>

            <div class="card">
                <h3>Cross-Domain Synthesis</h3>
                <div class="pill">Idempotent Algebra</div>
                <div class="pill">Category Theory</div>
                <div class="pill">HoTT</div>
                <div class="pill">Quantum</div>
                <div class="pill">Complex Systems</div>
                <div class="pill">Information Theory</div>
                <p class="metric" id="synthesisMetric">confidence: —</p>
                <ul class="list" id="synthesisList"></ul>
            </div>

            <div class="card">
                <h3>Information-Theoretic Unity</h3>
                <div id="infoViz" class="viz"></div>
            </div>

            <div class="card">
                <h3>Hypergraph Synchronization</h3>
                <div class="controls">
                    <input id="nodes" type="number" min="2" max="512" value="64" />
                    <input id="coupling" type="number" step="0.01" min="0" max="1" value="0.85" />
                    <button id="runSync">Run</button>
                </div>
                <div id="syncViz" class="viz"></div>
            </div>

            <div class="card">
                <h3>Unity Manifold</h3>
                <div class="controls">
                    <input id="mDim" type="number" min="2" max="11" value="3" />
                    <input id="mPhi" type="number" step="0.001" value="1.618" />
                    <input id="mIdem" type="number" step="0.1" value="1.0" />
                    <button id="manifoldBtn">Compute</button>
                </div>
                <div id="manifoldViz" class="viz"></div>
            </div>

            <div class="card">
                <h3>Meta-Gambit Explorer</h3>
                <p class="metric" id="gambitOut">recommendations: —</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = location.origin.replace(/\/$/, '') + '/visualizations'; // fallback auth-protected space
        const ALT_API = location.origin.replace(/\/$/, '') + '/unity-meta';      // preferred new routes

        async function apiGet(url) {
            try {
                const res = await fetch(url, { credentials: 'include' });
                if (!res.ok) throw new Error(await res.text());
                return await res.json();
            } catch (e) {
                console.warn('GET failed', url, e);
                throw e;
            }
        }

        async function apiPost(url, body) {
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(body)
                });
                if (!res.ok) throw new Error(await res.text());
                return await res.json();
            } catch (e) {
                console.warn('POST failed', url, e);
                throw e;
            }
        }

        // Energy
        document.getElementById('computeEnergy').addEventListener('click', async () => {
            const rho = parseFloat(document.getElementById('rho').value || '0');
            const U = parseFloat(document.getElementById('unityRate').value || '0');
            const energyOut = document.getElementById('energyOut');
            try {
                const data = await apiPost(ALT_API + '/energy', { consciousness_density: rho, unity_convergence_rate: U });
                energyOut.textContent = `energy: ${data.energy.toFixed(6)}  (φ=${data.phi})`;
            } catch {
                // graceful fallback using client-side φ
                const phi = 1.618033988749895; const energy = (phi * phi) * rho * U;
                energyOut.textContent = `energy: ${energy.toFixed(6)}  (φ=${phi})`;
            }
        });

        // Synthesis
        async function loadSynthesis() {
            const metricEl = document.getElementById('synthesisMetric');
            const listEl = document.getElementById('synthesisList');
            listEl.innerHTML = '';
            try {
                const s = await apiGet(ALT_API + '/synthesize');
                metricEl.textContent = `confidence: ${s.confidence.toFixed(3)}`;
                s.frameworks.forEach(f => {
                    const li = document.createElement('li');
                    li.textContent = `${f.name}: ${f.statement} (metric=${f.metric.toFixed(3)})`;
                    listEl.appendChild(li);
                });
            } catch (e) {
                metricEl.textContent = 'confidence: offline mode';
                ['Idempotent Algebra', 'Category Theory', 'HoTT', 'Quantum', 'Complex Systems', 'Information Theory'].forEach((n, i) => {
                    const li = document.createElement('li'); li.textContent = `${n}: metric≈${(0.9 - i * 0.03).toFixed(3)}`; listEl.appendChild(li);
                });
            }
        }

        // Information-theoretic unity visualization
        function drawInfoViz() {
            const z = [[0.25, 0.0], [0.0, 0.75]]; // perfect correlation proxy
            const data = [{ z, type: 'heatmap', colorscale: 'Viridis' }];
            const layout = { title: 'Joint Distribution (Perfect Correlation)', paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } };
            Plotly.newPlot('infoViz', data, layout, { displayModeBar: false, responsive: true });
        }

        // Synchronization viz
        document.getElementById('runSync').addEventListener('click', async () => {
            const n = parseInt(document.getElementById('nodes').value || '16', 10);
            const c = parseFloat(document.getElementById('coupling').value || '0.85');
            try {
                const res = await apiPost(ALT_API + '/simulate/synchronization', { num_nodes: n, coupling: c });
                const trace = { x: ['variance'], y: [res.final_phase_variance], type: 'bar', marker: { color: '#FFD700' } };
                Plotly.newPlot('syncViz', [trace], { title: `Unity Score: ${res.unity_score.toFixed(3)}`, paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            } catch (e) {
                const trace = { x: ['variance'], y: [0.01], type: 'bar', marker: { color: '#FFD700' } };
                Plotly.newPlot('syncViz', [trace], { title: 'Unity Score: 0.99 (offline)', paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            }
        });

        // Manifold summary
        document.getElementById('manifoldBtn').addEventListener('click', async () => {
            const d = parseInt(document.getElementById('mDim').value || '3', 10);
            const ph = parseFloat(document.getElementById('mPhi').value || '1.618');
            const iw = parseFloat(document.getElementById('mIdem').value || '1.0');
            try {
                const res = await apiPost(ALT_API + '/manifold/summary', { dimensions: d, phi_coupling: ph, idempotent_weight: iw });
                const keys = ['ricci_scalar', 'mean_curvature', 'unity_convergence', 'phi_alignment'];
                const trace = { x: keys, y: keys.map(k => res[k]), type: 'bar', marker: { color: ['#FFD700', '#00D4FF', '#9d4edd', '#FFD700'] } };
                Plotly.newPlot('manifoldViz', [trace], { title: `Unity Manifold (d=${res.dimensions})`, paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            } catch (e) {
                const trace = { x: ['ricci', 'mean', 'unity', 'phi'], y: [1, 0.2, 0.95, 0.99], type: 'bar', marker: { color: '#00D4FF' } };
                Plotly.newPlot('manifoldViz', [trace], { title: 'Unity Manifold (offline)', paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            }
        });

        // Meta-Gambit recommendations
        async function loadGambit() {
            const out = document.getElementById('gambitOut');
            try {
                const res = await apiGet(ALT_API + '/metagambit/recommendations');
                const rec = res.recommendations || {};
                const agents = Object.keys(rec).filter(k => k !== 'unity_potential');
                out.textContent = agents.map(a => `${a}: ${rec[a]}`).join(' | ') + ` | potential=${rec.unity_potential}`;
            } catch {
                out.textContent = 'A: Unify | B: Unify | potential≈0.9 (offline)';
            }
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            drawInfoViz();
            loadSynthesis();
            loadGambit();
        });
    </script>
</body>

</html>