<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unity Meta-Atlas | Een</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/unified-styles.css" />
    <script src="js/meta-optimal-navigation-complete.js" defer></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --bg: #0b0b0c;
            --surface: #131316;
            --text: #fff;
            --muted: #9aa0a6;
            --gold: #FFD700;
            --cyan: #00D4FF;
            --violet: #9d4edd;
            --radius: 16px;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: Inter, system-ui, sans-serif;
            margin: 0;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 112px 24px 48px;
        }

        .hero {
            text-align: center;
            margin-bottom: 16px;
        }

        .hero h1 {
            font-weight: 800;
            letter-spacing: -0.02em;
            font-size: clamp(2.2rem, 5vw, 3.2rem);
            color: var(--gold);
        }

        .sub {
            color: var(--muted);
        }

        .grid {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        }

        .card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius);
            padding: 16px;
        }

        .card h3 {
            margin: 0 0 6px 0;
            color: var(--cyan);
        }

        .pill {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(0, 212, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.25);
            color: var(--cyan);
            font-size: 12px;
            margin-right: 6px;
        }

        .viz {
            height: 420px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 6px 0 8px;
        }

        .controls input,
        .controls button {
            background: var(--surface);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            padding: 10px 12px;
            font-family: Inter;
        }

        .controls button {
            cursor: pointer;
            background: linear-gradient(135deg, var(--cyan), var(--violet));
            border: none;
            font-weight: 600;
        }

        .mono {
            font-family: "JetBrains Mono", monospace;
            color: var(--gold);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="hero">
            <h1>Unity Meta-Atlas</h1>
            <div class="sub">A living atlas of unity mathematics: synthesis, manifold geometry, metagambit equilibria,
                and φ-harmonic evolution</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Atlas Snapshot</h3>
                <div class="pill">Synthesis</div>
                <div class="pill">Manifold</div>
                <div class="pill">Meta-Gambit</div>
                <div class="pill">Information</div>
                <div id="atlasSynth" class="viz"></div>
            </div>

            <div class="card">
                <h3>Unity Manifold Invariants</h3>
                <div class="controls">
                    <input id="aDim" type="number" min="2" max="11" value="3" />
                    <input id="aPhi" type="number" step="0.001" value="1.618" />
                    <input id="aIdem" type="number" step="0.1" value="1.0" />
                    <button id="atlasManifoldBtn">Compute</button>
                </div>
                <div id="atlasManifold" class="viz"></div>
            </div>

            <div class="card">
                <h3>Recursive Evolution</h3>
                <div class="controls">
                    <input id="steps" type="number" min="1" max="100" value="7" />
                    <input id="phiTarget" type="number" step="0.001" placeholder="φ target (optional)" />
                    <button id="evolveBtn">Evolve</button>
                </div>
                <div id="atlasEvolve" class="viz"></div>
            </div>

            <div class="card">
                <h3>Meta-Gambit Equilibria</h3>
                <p class="mono" id="atlasGambit">—</p>
            </div>
        </div>
    </div>

    <script>
        const ALT_API = location.origin.replace(/\/$/, '') + '/unity-meta';

        async function apiGet(url) {
            const res = await fetch(url, { credentials: 'include' });
            if (!res.ok) throw new Error(await res.text());
            return await res.json();
        }

        async function apiPost(url, body) {
            const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, credentials: 'include', body: JSON.stringify(body) });
            if (!res.ok) throw new Error(await res.text());
            return await res.json();
        }

        async function loadSnapshot() {
            try {
                const snap = await apiGet(ALT_API + '/atlas/summary');
                const conf = snap.synthesis.confidence;
                const ricci = snap.manifold.ricci_scalar;
                const mi = snap.information_unity.I_XY;
                const pot = parseFloat(snap.metagambit.unity_potential || '0');
                const trace = { x: ['synthesis', 'ricci', 'mutual_info', 'meta_potential'], y: [conf, ricci, mi, pot], type: 'bar', marker: { color: ['#FFD700', '#00D4FF', '#9d4edd', '#FFD700'] } };
                Plotly.newPlot('atlasSynth', [trace], { title: 'Meta-Atlas Snapshot', paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
                const gambit = document.getElementById('atlasGambit');
                const rec = snap.metagambit || {}; const agents = Object.keys(rec).filter(k => k !== 'unity_potential');
                gambit.textContent = agents.map(a => `${a}: ${rec[a]}`).join(' | ') + ` | potential=${rec.unity_potential}`;
            } catch (e) {
                const trace = { x: ['synthesis', 'ricci', 'mutual_info', 'meta_potential'], y: [0.9, 1.2, 1.0, 0.92], type: 'bar', marker: { color: '#FFD700' } };
                Plotly.newPlot('atlasSynth', [trace], { title: 'Meta-Atlas Snapshot (offline)', paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
                document.getElementById('atlasGambit').textContent = 'A: Unify | B: Unify | potential≈0.92';
            }
        }

        document.getElementById('atlasManifoldBtn').addEventListener('click', async () => {
            const d = parseInt(document.getElementById('aDim').value || '3', 10);
            const ph = parseFloat(document.getElementById('aPhi').value || '1.618');
            const iw = parseFloat(document.getElementById('aIdem').value || '1.0');
            try {
                const res = await apiPost(ALT_API + '/manifold/summary', { dimensions: d, phi_coupling: ph, idempotent_weight: iw });
                const keys = ['ricci_scalar', 'mean_curvature', 'unity_convergence', 'phi_alignment'];
                const trace = { x: keys, y: keys.map(k => res[k]), type: 'bar', marker: { color: ['#FFD700', '#00D4FF', '#9d4edd', '#FFD700'] } };
                Plotly.newPlot('atlasManifold', [trace], { title: `Unity Manifold (d=${res.dimensions})`, paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            } catch (e) {
                const trace = { x: ['ricci', 'mean', 'unity', 'phi'], y: [1.1, 0.2, 0.95, 0.99], type: 'bar', marker: { color: '#00D4FF' } };
                Plotly.newPlot('atlasManifold', [trace], { title: 'Unity Manifold (offline)', paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            }
        });

        document.getElementById('evolveBtn').addEventListener('click', async () => {
            const s = parseInt(document.getElementById('steps').value || '7', 10);
            const ptxt = document.getElementById('phiTarget').value;
            const payload = { steps: s };
            if (ptxt && ptxt.trim().length) payload.phi_target = parseFloat(ptxt);
            try {
                const res = await apiPost(ALT_API + '/atlas/evolve', payload);
                const keys = ['synthesis_confidence', 'manifold.ricci_scalar', 'metagambit.unity_potential'];
                const y = [res.synthesis_confidence, res.manifold.ricci_scalar, parseFloat(res.metagambit.unity_potential || '0')];
                const trace = { x: ['confidence', 'ricci', 'meta_potential'], y, type: 'bar', marker: { color: ['#FFD700', '#00D4FF', '#9d4edd'] } };
                Plotly.newPlot('atlasEvolve', [trace], { title: `Evolution (steps=${res.steps}, φ=${res.phi})`, paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            } catch (e) {
                const trace = { x: ['confidence', 'ricci', 'meta_potential'], y: [0.97, 1.25, 0.95], type: 'bar', marker: { color: '#FFD700' } };
                Plotly.newPlot('atlasEvolve', [trace], { title: 'Evolution (offline)', paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { color: '#fff' } }, { displayModeBar: false, responsive: true });
            }
        });

        document.addEventListener('DOMContentLoaded', () => { loadSnapshot(); });
    </script>
</body>

</html>